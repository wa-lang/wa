# 凹语言本地化构建

目标是将凹语言代码编译到本地可执行程序. 凹语言编译器会将程序代码编译为本地的汇编代码, 入口是C语言规格的main函数. 最终的汇编代码到本地可执行程序会经有gcc汇编器或凹自研的汇编器汇编链接为可执行程序.

gcc汇编器生态更强大也更为成熟, 主要用于应用场景前沿探索, 用于支持需要深度依赖C库的场景. 自研汇编器用于构建基于系统调用无外部依赖的应用, 目前还处于实验性阶段主要用于龙芯国产自研芯片的构建.

注: 这是设计文件, 具体的细节还有待实现和完善.

## 构建目录

- 单文件构建和执行: 在 `${HOME}/wa/output/${file-name}/` 目录构建
- 工程构建和执行: 在 `${ROOT}/output/` 目录构建
- 构建目录的子目录细节参考实现

## 汇编代码混入

当需要访问凹语言不好实现的底层能力时, 可以在包中针对不太的平台定义汇编代码. 汇编代码是 gcc 汇编的子集, 具体请参考 [nasm.md](nasm.md) 文件.

最终混入的汇编代码会被复制到构建目录构建

## C代码混入

如果使用gcc汇编器工具链, 也支持在包中混入C语言代码. 这些C语言代码每个文件应该是独立的编译单元, 不能依赖相对路径的其他头文件.

最终混入的C代码会被复制到构建目录构建.

## 链接参数

当需要链接外部的C库时, 可以定义gcc参数文件(自研汇编器不支持). 文件中每一行对应一个参数, 不支持注释.

- `args_windows_x64.gcc.txt`: 对应 windows/x64 环境的gcc构建参数
- `args_linux_x64.gcc.txt`: 对应 linux/x64 环境的gcc构建参数
- `args_linux_loong64.gcc.txt`: 对应 linux/loong64 环境的gcc构建参数

文件中 `${XXX}` 风格的环境变量会被展开.


