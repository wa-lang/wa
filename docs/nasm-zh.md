# 凹汇编语言(The Wa Native Assembly Language) - 2026

凹汇编语言用于描述本地的汇编语言程序, 目前仅支持龙芯架构. 以下是 LOGO:

```
+---+    +---+
| o |    | o |
|   +----+   |
|            |
|    NASM    |
|            |
+------------+
```

汇编代码的后缀名 `.wz.s` 对应中文语法, `.wa.s` 对应 GAS 风格语法, 英文名字缩写: NASM.

## 你好世界 - 龙芯版本

```s
全局 .我的.字符串.数据: 字串 = "hello\n"
全局 .我的.字符串.长度: 四字 = 6

函数 准备:
    # 中文指令...
完毕

函数 主控:
    # 中文指令...
完毕

函数 普通函数:
    # 中文指令...
完毕
```

## 注释

`#` 开头的一行为注释

## 标识符

和C语言的标识符类似, 以字母下划线开头, 后续可以是字母和数字和下划线. 同时`.`和`$`也被视作字母.

## 常量

`常量 A=123` 定义 `A` 常量, 值为 123. 常量一般在头部定义, 常量本身不占内存空间.

## 全局变量

```
全局 .我的.字符串.数据: 字串 = "hello\n"
全局 .我的.字符串.长度: 四字 = 6
```

定义了字符串和8字节大小的空间. 全局变量有以下几种大小的空间:

- `字节`, 1个字节
- `单字`, 2个字节
- `双字`, 4个字节
- `四字`, 8个字节

以上是基础类型, 开始的地址以对应的大小对齐.

对于连续的空间有以下几种(1字节对齐):

- `字串`, ASCII字符串, 在结尾添加 `\0`
- `留空`, 预留多个字节的空间, 都用0填充
- `文件`, 以文件的数据初始化内存

以下是包含外部的资源文件:

```s
全局 .我的.图片: 文件 = "lena.jpg"
```

## 只读数据

```
只读 .我的.字符串.数据: 字串 = "hello\n"
只读 .我的.字符串.长度: 四字 = 6
```

和全局变量的规则一样, 但是在`.rodata`段分配空间, 运行时只读.

## 定义函数

函数需要绑定到代码段(`.text`), 并且必须4字节对齐:

```s
# 内存初始化函数
函数 内存初始化:
    # 中文指令...
完毕
```

## 特殊的函数

- `准备`时启动时调用一次
- `主控`是类似`main`的入口函数
- `_启动`是汇编的入口函数, 缺少时会自动生成, 也可手动调用`准备`和`主控`

## 地址对齐

- 全局变量会根据基础类型的大小对齐
- 字符串等连续的空间以1字节对齐
- 连续的同数据段的空间向量, 同时满足对齐约束
- 可通过垃圾桶标识符`_`定义占位空间, 对应gas语法的`.align`语句
- 函数强制以8字节对齐

## 补充说明

凹中文汇编语言是凹语言对于中文编程的底层探索, 希望从指令集和寄存器名层面定义中文的规范. 凹中文汇编由凹语言自带的汇编器构建.

凹中文汇编语言比凹汇编语言GAS语法更加抽象一点, 但是对于底层细节的控制会稍微弱一点. 在使用时尽量保持两边的约定一致.

