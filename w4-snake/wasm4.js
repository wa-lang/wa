var wasm4=function(A){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var ve;const pt=globalThis,_t=pt.ShadowRoot&&(pt.ShadyCSS===void 0||pt.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,St=Symbol(),Dt=new WeakMap;let Nt=class{constructor(t,e,s){if(this._$cssResult$=!0,s!==St)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(_t&&t===void 0){const s=e!==void 0&&e.length===1;s&&(t=Dt.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),s&&Dt.set(e,t))}return t}toString(){return this.cssText}};const _e=o=>new Nt(typeof o=="string"?o:o+"",void 0,St),ft=(o,...t)=>{const e=o.length===1?o[0]:t.reduce((s,i,n)=>s+(r=>{if(r._$cssResult$===!0)return r.cssText;if(typeof r=="number")return r;throw Error("Value passed to 'css' function must be a 'css' function result: "+r+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+o[n+1],o[0]);return new Nt(e,o,St)},Se=(o,t)=>{if(_t)o.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const s=document.createElement("style"),i=pt.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=e.cssText,o.appendChild(s)}},Bt=_t?o=>o:o=>o instanceof CSSStyleSheet?(t=>{let e="";for(const s of t.cssRules)e+=s.cssText;return _e(e)})(o):o;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:xe,defineProperty:ke,getOwnPropertyDescriptor:Ce,getOwnPropertyNames:Te,getOwnPropertySymbols:Pe,getPrototypeOf:$e}=Object,U=globalThis,Ft=U.trustedTypes,Ie=Ft?Ft.emptyScript:"",xt=U.reactiveElementPolyfillSupport,tt=(o,t)=>o,mt={toAttribute(o,t){switch(t){case Boolean:o=o?Ie:null;break;case Object:case Array:o=o==null?o:JSON.stringify(o)}return o},fromAttribute(o,t){let e=o;switch(t){case Boolean:e=o!==null;break;case Number:e=o===null?null:Number(o);break;case Object:case Array:try{e=JSON.parse(o)}catch{e=null}}return e}},kt=(o,t)=>!xe(o,t),Ht={attribute:!0,type:String,converter:mt,reflect:!1,hasChanged:kt};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),U.litPropertyMetadata??(U.litPropertyMetadata=new WeakMap);class Y extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Ht){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const s=Symbol(),i=this.getPropertyDescriptor(t,s,e);i!==void 0&&ke(this.prototype,t,i)}}static getPropertyDescriptor(t,e,s){const{get:i,set:n}=Ce(this.prototype,t)??{get(){return this[e]},set(r){this[e]=r}};return{get(){return i==null?void 0:i.call(this)},set(r){const c=i==null?void 0:i.call(this);n.call(this,r),this.requestUpdate(t,c,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Ht}static _$Ei(){if(this.hasOwnProperty(tt("elementProperties")))return;const t=$e(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(tt("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(tt("properties"))){const e=this.properties,s=[...Te(e),...Pe(e)];for(const i of s)this.createProperty(i,e[i])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[s,i]of e)this.elementProperties.set(s,i)}this._$Eh=new Map;for(const[e,s]of this.elementProperties){const i=this._$Eu(e,s);i!==void 0&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const s=new Set(t.flat(1/0).reverse());for(const i of s)e.unshift(Bt(i))}else t!==void 0&&e.push(Bt(t));return e}static _$Eu(t,e){const s=e.attribute;return s===!1?void 0:typeof s=="string"?s:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const s of e.keys())this.hasOwnProperty(s)&&(t.set(s,this[s]),delete this[s]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Se(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var s;return(s=e.hostConnected)==null?void 0:s.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var s;return(s=e.hostDisconnected)==null?void 0:s.call(e)})}attributeChangedCallback(t,e,s){this._$AK(t,s)}_$EC(t,e){var n;const s=this.constructor.elementProperties.get(t),i=this.constructor._$Eu(t,s);if(i!==void 0&&s.reflect===!0){const r=(((n=s.converter)==null?void 0:n.toAttribute)!==void 0?s.converter:mt).toAttribute(e,s.type);this._$Em=t,r==null?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(t,e){var n;const s=this.constructor,i=s._$Eh.get(t);if(i!==void 0&&this._$Em!==i){const r=s.getPropertyOptions(i),c=typeof r.converter=="function"?{fromAttribute:r.converter}:((n=r.converter)==null?void 0:n.fromAttribute)!==void 0?r.converter:mt;this._$Em=i,this[i]=c.fromAttribute(e,r.type),this._$Em=null}}requestUpdate(t,e,s){if(t!==void 0){if(s??(s=this.constructor.getPropertyOptions(t)),!(s.hasChanged??kt)(this[t],e))return;this.P(t,e,s)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(t,e,s){this._$AL.has(t)||this._$AL.set(t,e),s.reflect===!0&&this._$Em!==t&&(this._$Ej??(this._$Ej=new Set)).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var s;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,r]of this._$Ep)this[n]=r;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[n,r]of i)r.wrapped!==!0||this._$AL.has(n)||this[n]===void 0||this.P(n,this[n],r)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(s=this._$EO)==null||s.forEach(i=>{var n;return(n=i.hostUpdate)==null?void 0:n.call(i)}),this.update(e)):this._$EU()}catch(i){throw t=!1,this._$EU(),i}t&&this._$AE(e)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(s=>{var i;return(i=s.hostUpdated)==null?void 0:i.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EC(e,this[e]))),this._$EU()}updated(t){}firstUpdated(t){}}Y.elementStyles=[],Y.shadowRootOptions={mode:"open"},Y[tt("elementProperties")]=new Map,Y[tt("finalized")]=new Map,xt==null||xt({ReactiveElement:Y}),(U.reactiveElementVersions??(U.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const et=globalThis,yt=et.trustedTypes,Gt=yt?yt.createPolicy("lit-html",{createHTML:o=>o}):void 0,Wt="$lit$",O=`lit$${(Math.random()+"").slice(9)}$`,zt="?"+O,Ue=`<${zt}>`,D=document,st=()=>D.createComment(""),it=o=>o===null||typeof o!="object"&&typeof o!="function",Vt=Array.isArray,Oe=o=>Vt(o)||typeof(o==null?void 0:o[Symbol.iterator])=="function",Ct=`[ 	
\f\r]`,nt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,jt=/-->/g,Yt=/>/g,N=RegExp(`>|${Ct}(?:([^\\s"'>=/]+)(${Ct}*=${Ct}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Kt=/'/g,qt=/"/g,Xt=/^(?:script|style|textarea|title)$/i,Me=o=>(t,...e)=>({_$litType$:o,strings:t,values:e}),C=Me(1),K=Symbol.for("lit-noChange"),S=Symbol.for("lit-nothing"),Jt=new WeakMap,B=D.createTreeWalker(D,129);function Zt(o,t){if(!Array.isArray(o)||!o.hasOwnProperty("raw"))throw Error("invalid template strings array");return Gt!==void 0?Gt.createHTML(t):t}const Le=(o,t)=>{const e=o.length-1,s=[];let i,n=t===2?"<svg>":"",r=nt;for(let c=0;c<e;c++){const a=o[c];let h,l,d=-1,u=0;for(;u<a.length&&(r.lastIndex=u,l=r.exec(a),l!==null);)u=r.lastIndex,r===nt?l[1]==="!--"?r=jt:l[1]!==void 0?r=Yt:l[2]!==void 0?(Xt.test(l[2])&&(i=RegExp("</"+l[2],"g")),r=N):l[3]!==void 0&&(r=N):r===N?l[0]===">"?(r=i??nt,d=-1):l[1]===void 0?d=-2:(d=r.lastIndex-l[2].length,h=l[1],r=l[3]===void 0?N:l[3]==='"'?qt:Kt):r===qt||r===Kt?r=N:r===jt||r===Yt?r=nt:(r=N,i=void 0);const w=r===N&&o[c+1].startsWith("/>")?" ":"";n+=r===nt?a+Ue:d>=0?(s.push(h),a.slice(0,d)+Wt+a.slice(d)+O+w):a+O+(d===-2?c:w)}return[Zt(o,n+(o[e]||"<?>")+(t===2?"</svg>":"")),s]};class rt{constructor({strings:t,_$litType$:e},s){let i;this.parts=[];let n=0,r=0;const c=t.length-1,a=this.parts,[h,l]=Le(t,e);if(this.el=rt.createElement(h,s),B.currentNode=this.el.content,e===2){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(i=B.nextNode())!==null&&a.length<c;){if(i.nodeType===1){if(i.hasAttributes())for(const d of i.getAttributeNames())if(d.endsWith(Wt)){const u=l[r++],w=i.getAttribute(d).split(O),b=/([.?@])?(.*)/.exec(u);a.push({type:1,index:n,name:b[2],strings:w,ctor:b[1]==="."?De:b[1]==="?"?Ne:b[1]==="@"?Be:wt}),i.removeAttribute(d)}else d.startsWith(O)&&(a.push({type:6,index:n}),i.removeAttribute(d));if(Xt.test(i.tagName)){const d=i.textContent.split(O),u=d.length-1;if(u>0){i.textContent=yt?yt.emptyScript:"";for(let w=0;w<u;w++)i.append(d[w],st()),B.nextNode(),a.push({type:2,index:++n});i.append(d[u],st())}}}else if(i.nodeType===8)if(i.data===zt)a.push({type:2,index:n});else{let d=-1;for(;(d=i.data.indexOf(O,d+1))!==-1;)a.push({type:7,index:n}),d+=O.length-1}n++}}static createElement(t,e){const s=D.createElement("template");return s.innerHTML=t,s}}function q(o,t,e=o,s){var r,c;if(t===K)return t;let i=s!==void 0?(r=e._$Co)==null?void 0:r[s]:e._$Cl;const n=it(t)?void 0:t._$litDirective$;return(i==null?void 0:i.constructor)!==n&&((c=i==null?void 0:i._$AO)==null||c.call(i,!1),n===void 0?i=void 0:(i=new n(o),i._$AT(o,e,s)),s!==void 0?(e._$Co??(e._$Co=[]))[s]=i:e._$Cl=i),i!==void 0&&(t=q(o,i._$AS(o,t.values),i,s)),t}class Re{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:s}=this._$AD,i=((t==null?void 0:t.creationScope)??D).importNode(e,!0);B.currentNode=i;let n=B.nextNode(),r=0,c=0,a=s[0];for(;a!==void 0;){if(r===a.index){let h;a.type===2?h=new ot(n,n.nextSibling,this,t):a.type===1?h=new a.ctor(n,a.name,a.strings,this,t):a.type===6&&(h=new Fe(n,this,t)),this._$AV.push(h),a=s[++c]}r!==(a==null?void 0:a.index)&&(n=B.nextNode(),r++)}return B.currentNode=D,i}p(t){let e=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}}class ot{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,s,i){this.type=2,this._$AH=S,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=i,this._$Cv=(i==null?void 0:i.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=q(this,t,e),it(t)?t===S||t==null||t===""?(this._$AH!==S&&this._$AR(),this._$AH=S):t!==this._$AH&&t!==K&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Oe(t)?this.k(t):this._(t)}S(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.S(t))}_(t){this._$AH!==S&&it(this._$AH)?this._$AA.nextSibling.data=t:this.T(D.createTextNode(t)),this._$AH=t}$(t){var n;const{values:e,_$litType$:s}=t,i=typeof s=="number"?this._$AC(t):(s.el===void 0&&(s.el=rt.createElement(Zt(s.h,s.h[0]),this.options)),s);if(((n=this._$AH)==null?void 0:n._$AD)===i)this._$AH.p(e);else{const r=new Re(i,this),c=r.u(this.options);r.p(e),this.T(c),this._$AH=r}}_$AC(t){let e=Jt.get(t.strings);return e===void 0&&Jt.set(t.strings,e=new rt(t)),e}k(t){Vt(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,i=0;for(const n of t)i===e.length?e.push(s=new ot(this.S(st()),this.S(st()),this,this.options)):s=e[i],s._$AI(n),i++;i<e.length&&(this._$AR(s&&s._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,e);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class wt{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,s,i,n){this.type=1,this._$AH=S,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=n,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=S}_$AI(t,e=this,s,i){const n=this.strings;let r=!1;if(n===void 0)t=q(this,t,e,0),r=!it(t)||t!==this._$AH&&t!==K,r&&(this._$AH=t);else{const c=t;let a,h;for(t=n[0],a=0;a<n.length-1;a++)h=q(this,c[s+a],e,a),h===K&&(h=this._$AH[a]),r||(r=!it(h)||h!==this._$AH[a]),h===S?t=S:t!==S&&(t+=(h??"")+n[a+1]),this._$AH[a]=h}r&&!i&&this.j(t)}j(t){t===S?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class De extends wt{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===S?void 0:t}}class Ne extends wt{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==S)}}class Be extends wt{constructor(t,e,s,i,n){super(t,e,s,i,n),this.type=5}_$AI(t,e=this){if((t=q(this,t,e,0)??S)===K)return;const s=this._$AH,i=t===S&&s!==S||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,n=t!==S&&(s===S||i);i&&this.element.removeEventListener(this.name,this,s),n&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class Fe{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){q(this,t)}}const Tt=et.litHtmlPolyfillSupport;Tt==null||Tt(rt,ot),(et.litHtmlVersions??(et.litHtmlVersions=[])).push("3.1.2");const He=(o,t,e)=>{const s=(e==null?void 0:e.renderBefore)??t;let i=s._$litPart$;if(i===void 0){const n=(e==null?void 0:e.renderBefore)??null;s._$litPart$=i=new ot(t.insertBefore(st(),n),n,void 0,e??{})}return i._$AI(o),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class M extends Y{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e;const t=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=t.firstChild),t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=He(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)==null||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)==null||t.setConnected(!1)}render(){return K}}M._$litElement$=!0,M.finalized=!0,(ve=globalThis.litElementHydrateSupport)==null||ve.call(globalThis,{LitElement:M});const Pt=globalThis.litElementPolyfillSupport;Pt==null||Pt({LitElement:M}),(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const bt=o=>(t,e)=>{e!==void 0?e.addInitializer(()=>{customElements.define(o,t)}):customElements.define(o,t)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ge={attribute:!0,type:String,converter:mt,reflect:!1,hasChanged:kt},We=(o=Ge,t,e)=>{const{kind:s,metadata:i}=e;let n=globalThis.litPropertyMetadata.get(i);if(n===void 0&&globalThis.litPropertyMetadata.set(i,n=new Map),n.set(e.name,o),s==="accessor"){const{name:r}=e;return{set(c){const a=t.get.call(this);t.set.call(this,c),this.requestUpdate(r,a,o)},init(c){return c!==void 0&&this.P(r,void 0,o),c}}}if(s==="setter"){const{name:r}=e;return function(c){const a=this[r];t.call(this,c),this.requestUpdate(r,a,o)}}throw Error("Unsupported decorator location: "+s)};function ze(o){return(t,e)=>typeof e=="object"?We(o,t,e):((s,i,n)=>{const r=i.hasOwnProperty(n);return i.constructor.createProperty(n,r?{...s,wrapped:!0}:s),r?Object.getOwnPropertyDescriptor(i,n):void 0})(o,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function at(o){return ze({...o,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Qt=(o,t,e)=>(e.configurable=!0,e.enumerable=!0,Reflect.decorate&&typeof t!="object"&&Object.defineProperty(o,t,e),e);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ct(o,t){return(e,s,i)=>{const n=r=>{var c;return((c=r.renderRoot)==null?void 0:c.querySelector(o))??null};if(t){const{get:r,set:c}=typeof s=="object"?e:i??(()=>{const a=Symbol();return{get(){return this[a]},set(h){this[a]=h}}})();return Qt(e,s,{get(){let a=r.call(this);return a===void 0&&(a=n(this),(a!==null||this.hasUpdated)&&c.call(this,a)),a}})}return Qt(e,s,{get(){return n(this)}})}}const E=160,x=160,X=1024,Ve="WASM-4",je=[14743759,8831084,3172432,464929],$t=4,lt=20,Ye=22,te=26,ee=28,Ke=30,qe=31,Xe=32,Je=160,L=1,F=2,J=16,Z=32,H=64,G=128,Ze=1,Qe=2,se=1,ie=2,ts=Uint8Array.of(255,255,255,255,255,255,255,255,199,199,199,207,207,255,207,255,147,147,147,255,255,255,255,255,147,1,147,147,147,1,147,255,239,131,47,131,233,3,239,255,157,91,55,239,217,181,115,255,143,39,39,143,37,51,129,255,207,207,207,255,255,255,255,255,243,231,207,207,207,231,243,255,159,207,231,231,231,207,159,255,255,147,199,1,199,147,255,255,255,231,231,129,231,231,255,255,255,255,255,255,255,207,207,159,255,255,255,129,255,255,255,255,255,255,255,255,255,207,207,255,253,251,247,239,223,191,127,255,199,179,57,57,57,155,199,255,231,199,231,231,231,231,129,255,131,57,241,195,135,31,1,255,129,243,231,195,249,57,131,255,227,195,147,51,1,243,243,255,3,63,3,249,249,57,131,255,195,159,63,3,57,57,131,255,1,57,243,231,207,207,207,255,135,59,27,135,97,121,131,255,131,57,57,129,249,243,135,255,255,207,207,255,207,207,255,255,255,207,207,255,207,207,159,255,243,231,207,159,207,231,243,255,255,255,1,255,1,255,255,255,159,207,231,243,231,207,159,255,131,1,57,243,199,255,199,255,131,125,69,85,65,127,131,255,199,147,57,57,1,57,57,255,3,57,57,3,57,57,3,255,195,153,63,63,63,153,195,255,7,51,57,57,57,51,7,255,1,63,63,3,63,63,1,255,1,63,63,3,63,63,63,255,193,159,63,49,57,153,193,255,57,57,57,1,57,57,57,255,129,231,231,231,231,231,129,255,249,249,249,249,249,57,131,255,57,51,39,15,7,35,49,255,159,159,159,159,159,159,129,255,57,17,1,1,41,57,57,255,57,25,9,1,33,49,57,255,131,57,57,57,57,57,131,255,3,57,57,57,3,63,63,255,131,57,57,57,33,51,133,255,3,57,57,49,7,35,49,255,135,51,63,131,249,57,131,255,129,231,231,231,231,231,231,255,57,57,57,57,57,57,131,255,57,57,57,17,131,199,239,255,57,57,41,1,1,17,57,255,57,17,131,199,131,17,57,255,153,153,153,195,231,231,231,255,1,241,227,199,143,31,1,255,195,207,207,207,207,207,195,255,127,191,223,239,247,251,253,255,135,231,231,231,231,231,135,255,199,147,255,255,255,255,255,255,255,255,255,255,255,255,255,1,239,247,255,255,255,255,255,255,255,255,131,249,129,57,129,255,63,63,3,57,57,57,131,255,255,255,129,63,63,63,129,255,249,249,129,57,57,57,129,255,255,255,131,57,1,63,131,255,241,231,129,231,231,231,231,255,255,255,129,57,57,129,249,131,63,63,3,57,57,57,57,255,231,255,199,231,231,231,129,255,243,255,227,243,243,243,243,135,63,63,49,3,7,35,49,255,199,231,231,231,231,231,129,255,255,255,3,73,73,73,73,255,255,255,3,57,57,57,57,255,255,255,131,57,57,57,131,255,255,255,3,57,57,3,63,63,255,255,129,57,57,129,249,249,255,255,145,143,159,159,159,255,255,255,131,63,131,249,3,255,231,231,129,231,231,231,231,255,255,255,57,57,57,57,129,255,255,255,153,153,153,195,231,255,255,255,73,73,73,73,129,255,255,255,57,1,199,1,57,255,255,255,57,57,57,129,249,131,255,255,1,227,199,143,1,255,243,231,231,207,231,231,243,255,231,231,231,231,231,231,231,255,159,207,207,231,207,207,159,255,255,255,143,69,227,255,255,255,255,255,255,255,255,147,147,255,131,41,41,17,41,41,131,255,131,57,9,17,33,57,131,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,131,17,33,125,33,17,131,255,131,17,9,125,9,17,131,255,131,17,57,85,17,17,131,255,131,17,17,85,57,17,131,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,231,255,231,231,199,199,199,255,239,131,41,47,41,131,239,255,195,153,159,3,159,159,1,255,255,165,219,219,219,165,255,255,153,153,195,129,231,129,231,255,231,231,231,255,231,231,231,255,195,153,135,219,225,153,195,255,147,255,255,255,255,255,255,255,195,189,102,94,94,102,189,195,135,195,147,195,255,255,255,255,255,201,147,39,147,201,255,255,255,255,129,249,249,255,255,255,255,255,255,255,255,255,255,255,195,189,70,90,70,90,189,195,131,255,255,255,255,255,255,255,239,215,239,255,255,255,255,255,231,231,129,231,231,255,129,255,199,243,231,195,255,255,255,255,195,231,243,199,255,255,255,255,247,239,255,255,255,255,255,255,255,255,51,51,51,51,9,63,193,149,181,149,193,245,245,255,255,255,255,207,207,255,255,255,255,255,255,255,255,255,247,207,231,199,231,195,255,255,255,255,199,147,147,199,255,255,255,255,255,39,147,201,147,39,255,255,189,59,183,173,217,177,125,255,189,59,183,169,221,187,113,255,29,187,215,45,217,177,125,255,199,255,199,159,57,1,131,255,223,239,199,147,57,1,57,255,247,239,199,147,57,1,57,255,199,147,199,147,57,1,57,255,203,167,199,147,57,1,57,255,147,255,199,147,57,1,57,255,239,215,199,147,57,1,57,255,193,135,39,33,7,39,33,255,195,153,63,63,153,195,247,207,223,239,1,63,3,63,1,255,247,239,1,63,3,63,1,255,199,147,1,63,3,63,1,255,147,255,1,63,3,63,1,255,239,247,129,231,231,231,129,255,247,239,129,231,231,231,129,255,231,195,129,231,231,231,129,255,153,255,129,231,231,231,129,255,135,147,153,9,153,147,135,255,203,167,25,9,1,33,49,255,223,239,131,57,57,57,131,255,247,239,131,57,57,57,131,255,199,147,131,57,57,57,131,255,203,167,131,57,57,57,131,255,147,255,131,57,57,57,131,255,255,187,215,239,215,187,255,255,131,57,49,41,25,57,131,255,223,239,57,57,57,57,131,255,247,239,57,57,57,57,131,255,199,147,255,57,57,57,131,255,147,255,57,57,57,57,131,255,247,239,153,153,195,231,231,255,63,3,57,57,57,3,63,255,195,153,153,147,153,137,147,255,223,239,131,249,129,57,129,255,247,239,131,249,129,57,129,255,199,147,131,249,129,57,129,255,203,167,131,249,129,57,129,255,147,255,131,249,129,57,129,255,239,215,131,249,129,57,129,255,255,255,131,233,129,47,131,255,255,255,129,63,63,129,247,207,223,239,131,57,1,63,131,255,247,239,131,57,1,63,131,255,199,147,131,57,1,63,131,255,147,255,131,57,1,63,131,255,223,239,255,199,231,231,129,255,247,239,255,199,231,231,129,255,199,147,255,199,231,231,129,255,147,255,199,231,231,231,129,255,155,135,103,131,57,57,131,255,203,167,3,57,57,57,57,255,223,239,131,57,57,57,131,255,247,239,131,57,57,57,131,255,199,147,131,57,57,57,131,255,203,167,131,57,57,57,131,255,147,255,131,57,57,57,131,255,255,231,255,129,255,231,255,255,255,255,131,49,41,25,131,255,223,239,57,57,57,57,129,255,247,239,57,57,57,57,129,255,199,147,255,57,57,57,129,255,147,255,57,57,57,57,129,255,247,239,57,57,57,129,249,131,63,63,3,57,57,3,63,63,147,255,57,57,57,129,249,131);function It(o){const t=new URL(location.href),e=t.searchParams.get(o);return e??new URL(t.hash.substring(1),"https://x").searchParams.get(o)}function ne(){if(document.fullscreenElement==null){let o=function(){const e=window.frameElement;e&&(e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.zIndex="99999",e.style.width="100%",e.style.height="100%")};const t=document.body.requestFullscreen&&document.body.requestFullscreen({navigationUI:"hide"});t?t.catch(o):o()}}async function es(o){try{await navigator.clipboard.writeText(o)}catch{let t=document.createElement("dialog");t.title="Netplay URL",t.textContent=o,document.body.append(t);let e=document.createElement("button");e.textContent="Copy",e.style.marginLeft="1em",e.onclick=()=>navigator.clipboard.writeText(o),t.appendChild(e);let s=document.createElement("button");s.textContent="Close",s.style.marginLeft="1em",s.onclick=()=>{document.body.removeChild(t)},t.appendChild(s),t.showModal()}}const ss="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),re=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];function oe(o){const t=o.length,e=t%4,s=e?t+4-e:t;let i="",n=0,r=0;for(;n<s;){const c=n<t?o[n]:0;if(++n,r=r*256+c,n%4==0){let a=52200625;for(;a>=1;){const h=Math.floor(r/a)%85;i+=ss[h],a/=85}r=0}}return i}function ae(o,t){let e=0,s=0,i=0;const n=o.length,r=t.length;if(o.length%5==0)for(;s<n;){const c=o.charCodeAt(s++)-32;if(c<0||c>=re.length)return e;if(i=i*85+re[c],s%5==0){let a=16777216;for(;a>=1;){if(e>=r)return e;t[e++]=i/a%256,a/=256}i=0}}return e}class ht{constructor(){this.memory=new ArrayBuffer(65536),this.globals={},this.diskBuffer=new ArrayBuffer(X),this.diskSize=0}read(t){new Uint8Array(this.memory).set(new Uint8Array(t.memory.buffer)),this.globals={};for(const e in t.wasm.exports){const s=t.wasm.exports[e];s instanceof WebAssembly.Global&&(this.globals[e]=s.value.toString())}this.diskSize=t.diskSize,new Uint8Array(this.diskBuffer).set(new Uint8Array(t.diskBuffer,0,t.diskSize))}write(t){new Uint8Array(t.memory.buffer).set(new Uint8Array(this.memory));for(const e in t.wasm.exports){const s=t.wasm.exports[e];s instanceof WebAssembly.Global&&e in this.globals&&(s.value=this.globals[e])}t.diskSize=this.diskSize,new Uint8Array(t.diskBuffer).set(new Uint8Array(this.diskBuffer,0,this.diskSize))}toBytes(){const t=new TextEncoder().encode(JSON.stringify(this.globals)),e=new Uint8Array(65544+t.byteLength+this.diskSize),s=new DataView(e.buffer,e.byteOffset,e.byteLength);e.set(new Uint8Array(this.memory),0);let i=65536;return s.setUint32(i,t.byteLength),e.set(t,i+4),i+=4+t.byteLength,s.setUint32(i,this.diskSize),e.set(new Uint8Array(this.diskBuffer,0,this.diskSize),i+4),e}fromBytes(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);new Uint8Array(this.memory).set(t.subarray(0,65536));let s=65536;const i=e.getUint32(s),n=t.slice(s+4,s+4+i);this.globals=JSON.parse(new TextDecoder().decode(n)),s+=4+i,this.diskSize=e.getUint32(s),new Uint8Array(this.diskBuffer).set(t.subarray(s+4,s+4+this.diskSize))}}const I=20,R=4;class is{constructor(){this.frame=-1,this.state=new ht,this.inputs=new Array(R),this.predicted=new Array(R);for(let t=0;t<R;++t)this.inputs[t]=0,this.predicted[t]=!0}}class ns{constructor(){this.futureInputs=new Map}}class ce{constructor(t,e){this.currentFrame=t,this.runtime=e,this.rollbackIdx=I,this.history=new Array(I);for(let s=0;s<I;++s)this.history[s]=new is;this.players=new Array(R);for(let s=0;s<R;++s)this.players[s]=new ns}addInputs(t,e,s){const i=this.players[t];for(const n of s){if(e>=this.currentFrame)i.futureInputs.has(e)||i.futureInputs.set(e,n);else for(let r=0,c=I;r<c;++r){const a=this.history[r];if(a.frame==e){a.predicted[t]&&(a.predicted[t]=!1,a.inputs[t]!=n&&(a.inputs[t]=n,this.rollbackIdx=Math.min(r,this.rollbackIdx)));break}}++e}}update(){if(this.rollbackIdx<I){for(let i=this.rollbackIdx+1;i<I;++i){const n=this.history[i];for(let r=0;r<R;++r)if(n.predicted[r]){const c=this.history[i-1];n.inputs[r]=c.inputs[r]}}let s=!0;for(;this.rollbackIdx<I;){const i=this.history[this.rollbackIdx++];s?(s=!1,i.state.write(this.runtime)):i.state.read(this.runtime);for(let n=0;n<R;++n)this.runtime.setGamepad(n,i.inputs[n]);this.runtime.update()}}const t=this.history[I-1],e=this.history.shift();this.history.push(e),e.frame=this.currentFrame,e.state.read(this.runtime);for(let s=0;s<R;++s){const i=this.players[s];let n=i.futureInputs.get(this.currentFrame);n!=null?(e.predicted[s]=!1,i.futureInputs.delete(this.currentFrame)):(e.predicted[s]=!0,n=t.inputs[s]),e.inputs[s]=n,this.runtime.setGamepad(s,n)}this.runtime.update(),++this.currentFrame}}class rs{constructor(t){this.onMessage=t,this.bufferedOutput=[],this.connect(),this.keepaliveInterval=window.setInterval(()=>{this.send("",{type:"KEEPALIVE"},!1)},15e3)}async connect(){const t=["wss://webrtc-signal-server.wasm4.org","wss://ywc2h85cv1.execute-api.us-east-1.amazonaws.com/production","wss://webrtc-signal-server.wasm4.jwq.moe","wss://iyuavuru2h.execute-api.eu-central-1.amazonaws.com/production"];for(const e of t)try{this.socket=await new Promise((s,i)=>{const n=new WebSocket(e);n.addEventListener("open",()=>{s(n)}),n.addEventListener("error",()=>{i()})});break}catch(s){console.error(s)}if(!this.socket)throw new Error("Unable to connect to signal server");this.socket.addEventListener("message",e=>{const{source:s,message:i}=JSON.parse(e.data);this.onMessage(s,i)});for(const e of this.bufferedOutput)this.socket.send(e);this.bufferedOutput.length=0}send(t,e,s=!0){var n;const i=JSON.stringify({target:t,message:e});((n=this.socket)==null?void 0:n.readyState)==1?this.socket.send(i):s&&this.bufferedOutput.push(i)}close(){var t;(t=this.socket)==null||t.close(),window.clearInterval(this.keepaliveInterval)}}class os{constructor(t){this.connections=new Map;let e;this.localPeerId=new Promise(s=>{e=s}),this.signalClient=new rs(async(s,i)=>{switch(i.type){case"WHOAMI_REPLY":this.iceServers=i.iceServers,e(i.yourPeerId);break;case"OFFER":{if(this.connections.has(s))throw new Error("Received offer for a connection we already initiated");{const n=this.createConnection(s);await n.setRemoteDescription(i.description),await n.setLocalDescription(await n.createAnswer()),t(n,s),this.signalClient.send(s,{type:"ANSWER",description:n.localDescription.toJSON()})}}break;case"ANSWER":{const n=this.connections.get(s);n&&await n.setRemoteDescription(i.description)}break;case"CANDIDATE":{const n=this.connections.get(s);n&&await n.addIceCandidate(new RTCIceCandidate(i.candidate))}break;case"ABORT":{const n=this.connections.get(s);n&&n.close()}break}}),this.signalClient.send("",{type:"WHOAMI_REQUEST"})}createConnection(t){const e=new RTCPeerConnection({iceServers:this.iceServers});return this.connections.set(t,e),e.addEventListener("negotiationneeded",async()=>{await e.setLocalDescription(await e.createOffer()),this.signalClient.send(t,{type:"OFFER",description:e.localDescription.toJSON()})}),e.addEventListener("icecandidate",({candidate:s})=>{s&&this.signalClient.send(t,{type:"CANDIDATE",candidate:s.toJSON()})}),e.addEventListener("connectionstatechange",()=>{const s=e.connectionState;(s=="connected"||s=="failed")&&this.connections.delete(t)}),e}connect(t){return this.connections.get(t)||this.createConnection(t)}close(){this.signalClient.close();for(const[t,e]of this.connections)e.close()}}const gt=16384;class as{constructor(t){this.chunks=[],this.size=0,t.addEventListener("message",e=>{if(e.data instanceof ArrayBuffer){const s=new Uint8Array(e.data);this.size+=s.byteLength,this.chunks.push(s)}})}read(){const t=new Uint8Array(this.size);let e=0;for(const s of this.chunks)t.set(s,e),e+=s.byteLength;return this.chunks.length=0,this.size=0,t}}class cs{constructor(t){this.channel=t,this.size=0}write(t){this.buffer||(this.buffer=new Uint8Array(gt));let e=this.size,s=0;for(;s<t.length;){const i=t.subarray(s,s+gt-e);this.buffer.set(i,e),s+=i.length,e+=i.length,e>=gt&&(e-=gt,this.channel.send(this.buffer))}this.size=e}flush(){this.buffer&&this.size>0&&this.channel.send(this.buffer.subarray(0,this.size)),this.buffer=void 0}}class ls{constructor(t,e=0){this.buffer=t,this.position=e}readBit(){const t=!!(this.buffer[this.position/8>>>0]&1<<(this.position&7));return++this.position,t}readBits(t){let e=0;for(let s=0;s<t;++s)e|=+this.readBit()<<s;return e}}class hs{constructor(t,e=0){this.buffer=t,this.position=e}write1(){this.buffer[this.position/8>>>0]|=1<<(this.position&7),++this.position}write0(){this.buffer[this.position/8>>>0]&=~(1<<(this.position&7)),++this.position}writeBits(t,e){for(let s=0;s<e;++s)t&1<<s?this.write1():this.write0()}}class le{constructor(t=.125){this.discount=t,this.average=0,this.firstUpdate=!0}update(t){if(this.firstUpdate)this.firstUpdate=!1,this.average=t;else{const e=this.discount;this.average=(1-e)*this.average+e*t}}}const he=20,ds=8+Math.ceil(he*(1+8*4)/8),W=new ArrayBuffer(ds);class us{constructor(t,e,s,i){this.peerId=t,this.connection=e,this.reliableChannel=s,this.unreliableChannel=i,this.playerIdx=-1,this.frame=0,this.nextNeededFrame=0,this.outboundFrame=0,this.outboundInputs=[],this.ping=new le,this.drift=new le,this.chunkReader=new as(s),this.chunkWriter=new cs(s)}addOutboundInput(t,e){if(this.outboundFrame==0&&(this.outboundFrame=t),t<this.outboundFrame){for(let s=this.outboundFrame-t;s>0;--s)this.outboundInputs.unshift(e);this.outboundFrame=t}else{const s=t-this.outboundFrame;if(s>=this.outboundInputs.length){for(let i=this.outboundInputs.length;i<s;++i)this.outboundInputs[i]=i>0?this.outboundInputs[i-1]:0;this.outboundInputs[s]=e}}}sendMessage(t){this.reliableChannel.send(JSON.stringify(t))}sendUnreliableBuffer(t){this.unreliableChannel.send(t)}sendPingRequest(){const t=new DataView(W);t.setUint8(0,2),t.setUint32(1,performance.now()>>>0),this.sendUnreliableBuffer(new Uint8Array(W,0,5))}sendPingReply(t){const e=new DataView(W);e.setUint8(0,3),e.setUint32(1,t),this.sendUnreliableBuffer(new Uint8Array(W,0,5))}sendTick(t){const e=new DataView(W);e.setUint8(0,1),e.setUint32(1,t),e.setInt8(5,this.nextNeededFrame==0?-127:this.nextNeededFrame-t),e.setInt8(6,this.outboundFrame-t),e.setUint8(7,this.outboundInputs.length);const s=new hs(new Uint8Array(W,8));let i=0;for(const r of this.outboundInputs){const c=i^r;i=r;for(let a=0;a<8;++a)c&1<<a&&(s.write1(),s.writeBits(a,3));s.write0()}const n=8+Math.ceil(s.position/8);this.sendUnreliableBuffer(new Uint8Array(W,0,n))}close(){this.reliableChannel.close(),this.unreliableChannel.close(),this.connection.close()}}class ps{constructor(t){this.runtime=t,this.remotePlayers=new Map,this.localPlayerIdx=-1,this.updateCount=0,this.peerMgr=new os(async(e,s)=>{const i=Array.from(this.remotePlayers.keys()),n=await this.createRemotePlayer(e,s);n.sendMessage({type:"WELCOME",otherPeers:i}),this.localPlayerIdx>=0&&n.sendMessage({type:"PLAYER_INFO",playerIdx:this.localPlayerIdx})})}host(){this.runtime.setNetplay(0),this.rollbackMgr=new ce(1,this.runtime),this.localPlayerIdx=0}join(t){const e=this.peerMgr.connect(t);this.createRemotePlayer(e,t).then(s=>{s.sendMessage({type:"JOIN_REQUEST"})},s=>{this.runtime.blueScreen(`Failed to connect
to peer. They may
be offline?`)})}async getInviteLink(){const t=await this.peerMgr.localPeerId,e=window.location;if(e.protocol=="file:"||e.hostname=="localhost"||e.hostname=="127.0.0.1"||e.hostname=="wasm4.org")return`https://wasm4.org/netplay/#${t}`;const s=new URL(e.href);return s.searchParams.set("netplay",t),s.href}close(){for(const t of this.remotePlayers.values())t.close();this.peerMgr.close()}async createRemotePlayer(t,e){function s(a){return new Promise((h,l)=>{const d=t.createDataChannel("WASM-4",a);d.binaryType="arraybuffer",d.onopen=()=>{h(d)},d.onerror=l})}const[i,n]=await Promise.all([s({negotiated:!0,id:0}),s({negotiated:!0,id:1,ordered:!1,maxRetransmits:0})]),r=new us(e,t,i,n);this.remotePlayers.set(e,r);const c=()=>{this.remotePlayers.has(e)&&(this.remotePlayers.delete(e),this.onleave&&r.playerIdx>=0&&this.onleave(r.playerIdx))};return t.addEventListener("connectionstatechange",()=>{t.connectionState=="disconnected"&&c()}),i.addEventListener("close",c),n.addEventListener("close",c),i.addEventListener("message",async a=>{if(typeof a.data!="string")return;const h=JSON.parse(a.data);switch(h.type){case"WELCOME":for(const l of h.otherPeers)if(!this.remotePlayers.has(l)){const d=this.peerMgr.connect(l),u=await this.createRemotePlayer(d,l);this.localPlayerIdx>=0&&u.sendMessage({type:"PLAYER_INFO",playerIdx:this.localPlayerIdx})}break;case"JOIN_REQUEST":{const l=this.nextPlayerIdx();if(l>=4)r.sendMessage({type:"JOIN_REJECT"}),r.close();else{r.playerIdx=l,r.chunkWriter.write(this.runtime.wasmBuffer);const d=new ht;d.read(this.runtime),r.chunkWriter.write(d.toBytes()),r.chunkWriter.flush(),r.sendMessage({type:"JOIN_REPLY",yourPlayerIdx:r.playerIdx,frame:this.rollbackMgr.currentFrame,stateOffset:this.runtime.wasmBuffer.byteLength}),this.onjoin&&this.onjoin(r.playerIdx)}}break;case"JOIN_REPLY":{this.localPlayerIdx=h.yourPlayerIdx;for(const b of this.remotePlayers.values())b!=r&&b.sendMessage({type:"PLAYER_INFO",playerIdx:this.localPlayerIdx});const l=r.chunkReader.read(),d=l.subarray(0,h.stateOffset),u=l.subarray(h.stateOffset);await this.runtime.load(d,!1);const w=new ht;w.fromBytes(u),w.write(this.runtime),this.runtime.setNetplay(this.localPlayerIdx),this.rollbackMgr=new ce(h.frame,this.runtime),this.onstart&&this.onstart(this.localPlayerIdx)}break;case"JOIN_REJECT":this.runtime.blueScreen(`Connected, but the
game is already
full!`),this.close();break;case"PLAYER_INFO":r.playerIdx==-1&&(r.playerIdx=h.playerIdx,this.onjoin&&this.onjoin(r.playerIdx));break}}),n.addEventListener("message",async a=>{const h=a.data,l=new DataView(h);switch(l.getUint8(0)){case 1:if(this.rollbackMgr&&r.playerIdx>=0){const u=l.getUint32(1);if(u>r.frame){const w=l.getInt8(5)+u,b=l.getInt8(6)+u,p=l.getUint8(7),f=new ls(new Uint8Array(h,8)),m=new Array(p);let y=0;for(let v=0;v<p;++v){for(;f.readBit();){const k=f.readBits(3);y^=1<<k}m[v]=y}if(r.frame=u,r.nextNeededFrame=b+m.length,r.outboundFrame==0)r.outboundFrame=w;else if(w>r.outboundFrame){const v=w-r.outboundFrame;r.outboundFrame=w,r.outboundInputs.splice(0,v)}const g=u+.5*r.ping.average*60/1e3,_=this.rollbackMgr.currentFrame-g;r.drift.update(_),this.rollbackMgr.addInputs(r.playerIdx,b,m)}}break;case 2:{const u=l.getUint32(1);r.sendPingReply(u)}break;case 3:{const u=l.getUint32(1),w=(performance.now()>>>0)-u;r.ping.update(w)}break}}),r}nextPlayerIdx(){t:for(let t=0;t<4;++t)if(this.localPlayerIdx!=t){for(const e of this.remotePlayers.values())if(e.playerIdx==t)continue t;return t}return-1}update(t){if(!this.rollbackMgr)return!1;const e=(this.updateCount&7)==0,s=(this.updateCount&31)==0;++this.updateCount;const i=this.rollbackMgr.currentFrame,r=i+2;this.rollbackMgr.addInputs(this.localPlayerIdx,r,[t]);let c=!1;for(const a of this.remotePlayers.values())a.addOutboundInput(r,t),a.sendTick(i),(a.nextNeededFrame<i-I||a.outboundInputs.length>=he)&&(c=!0),s&&a.sendPingRequest();if(e){let a=0;for(const h of this.remotePlayers.values())a=Math.max(h.drift.average,a);a>=1&&(c=!0)}return c||this.rollbackMgr.update(),!c}getSummary(){const t=[{playerIdx:this.localPlayerIdx,ping:-1}];for(const e of this.remotePlayers.values())t.push({playerIdx:e.playerIdx,ping:e.ping.average});return t.sort((e,s)=>e.playerIdx-s.playerIdx),t}}const de=`"use strict";(()=>{var M=Math.floor(44.1),b=class{constructor(){this.freq1=0;this.freq2=0;this.startTime=0;this.attackTime=0;this.decayTime=0;this.sustainTime=0;this.releaseTime=0;this.endTick=0;this.sustainVolume=0;this.peakVolume=0;this.phase=0;this.pan=0;this.pulseDutyCycle=0;this.noiseSeed=1;this.noiseLastRandom=0}};function L(m,e,s){return m+s*(e-m)}function V(m,e){if(m<e){let s=m/e;return s+s-s*s}else if(m>1-e){let s=(m-(1-e))/e;return 1-(s+s-s*s)}else return 1}function x(m,e){return Math.pow(2,(m-69+e/256)/12)*440}var y=class extends AudioWorkletProcessor{constructor(){super(),this.time=0,this.ticks=0,this.channels=new Array(4);for(let e=0;e<4;++e)this.channels[e]=new b;this.port!=null&&(this.port.onmessage=e=>{e.data==="tick"?this.tick():this.tone(...e.data)})}ramp(e,s,f,u){if(this.time>=u)return s;let a=(this.time-f)/(u-f);return L(e,s,a)}getCurrentFrequency(e){return e.freq2>0?this.ramp(e.freq1,e.freq2,e.startTime,e.releaseTime):e.freq1}getCurrentVolume(e){let s=this.time;return s>=e.sustainTime&&e.releaseTime-e.sustainTime>M?this.ramp(e.sustainVolume,0,e.sustainTime,e.releaseTime):s>=e.decayTime?e.sustainVolume:s>=e.attackTime?this.ramp(e.peakVolume,e.sustainVolume,e.attackTime,e.decayTime):this.ramp(0,e.peakVolume,e.startTime,e.attackTime)}tick(){this.ticks++}tone(e,s,f,u){let a=e&65535,p=e>>16&65535,A=s&255,h=s>>8&255,o=s>>16&255,i=s>>24&255,E=Math.min(f&255,100),l=Math.min(f>>8&255,100),n=u&3,r=u>>2&3,c=u>>4&3,d=u&64,t=this.channels[n];this.time>t.releaseTime&&this.ticks!=t.endTick&&(t.phase=n==2?.25:0),d?(t.freq1=x(a&255,a>>8),t.freq2=p==0?0:x(p&255,p>>8)):(t.freq1=a,t.freq2=p),t.startTime=this.time,t.attackTime=t.startTime+(44100*i/60>>>0),t.decayTime=t.attackTime+(44100*o/60>>>0),t.sustainTime=t.decayTime+(44100*A/60>>>0),t.releaseTime=t.sustainTime+(44100*h/60>>>0),t.endTick=this.ticks+i+o+A+h,t.pan=c;let T=n==2?.25:.15;if(t.sustainVolume=T*E/100,t.peakVolume=l?T*l/100:T,n==0||n==1)switch(r){case 0:t.pulseDutyCycle=.125;break;case 1:case 3:default:t.pulseDutyCycle=.25;break;case 2:t.pulseDutyCycle=.5;break}else n==2&&h==0&&(t.releaseTime+=M)}process(e,[[s,f]],u){for(let a=0,p=s.length;a<p;++a,++this.time){let A=0,h=0;for(let o=0;o<4;++o){let i=this.channels[o];if(this.time<i.releaseTime||this.ticks==i.endTick){let E=this.getCurrentFrequency(i),l=this.getCurrentVolume(i),n;if(o==3){for(i.phase+=E*E/(1e6/44100*44100);i.phase>0;){i.phase--;let r=i.noiseSeed;r^=r>>7,r^=r<<9,r^=r>>13,i.noiseSeed=r,i.noiseLastRandom=((r&1)<<1)-1}n=l*i.noiseLastRandom}else{let r=E/44100,c=i.phase+r;if(c>=1&&c--,i.phase=c,o==2)n=l*(2*Math.abs(2*i.phase-1)-1);else{let d,t,T,k=i.pulseDutyCycle;c<k?(d=c/k,t=r/k,T=l):(d=(c-k)/(1-k),t=r/(1-k),T=-l),n=T*V(d,t)}}i.pan!=1&&(h+=n),i.pan!=2&&(A+=n)}}s[a]=A,f[a]=h}return!0}};registerProcessor("wasm4-apu",y);})();
`;class fs{constructor(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100})}async init(){const t=this.audioCtx,e=new Blob([de],{type:"application/javascript"}),s=URL.createObjectURL(e);try{await t.audioWorklet.addModule(s);const i=new AudioWorkletNode(t,"wasm4-apu",{outputChannelCount:[2]});this.processorPort=i.port,i.connect(t.destination)}catch(i){console.warn("AudioWorklet loading failed, falling back to slow audio",i);let n;const r=(h,l)=>{n=new l};new Function("registerProcessor","AudioWorkletProcessor",de)(r,class{}),this.processor=n;const a=t.createScriptProcessor(1024,0,2);a.onaudioprocess=h=>{const l=h.outputBuffer.getChannelData(0),d=h.outputBuffer.getChannelData(1);n.process(null,[[l,d]],null)},a.connect(t.destination)}}tick(){this.processorPort!=null?this.processorPort.postMessage("tick"):this.processor.tick()}tone(t,e,s,i){this.processorPort!=null?this.processorPort.postMessage([t,e,s,i]):this.processor.tone(t,e,s,i)}unlockAudio(){const t=this.audioCtx;t.state=="suspended"&&t.resume()}pauseAudio(){const t=this.audioCtx;t.state=="running"&&t.suspend()}}class ms{constructor(t){this.bytes=new Uint8Array(t,Je,E*x>>>2),this.drawColors=new Uint16Array(t,lt,1)}clear(){this.bytes.fill(0)}drawPoint(t,e,s){const i=E*s+e>>>2,n=(e&3)<<1,r=3<<n;this.bytes[i]=t<<n|this.bytes[i]&~r}drawPointUnclipped(t,e,s){e>=0&&e<E&&s>=0&&s<x&&this.drawPoint(t,e,s)}drawHLineFast(t,e,s,i){const n=i-(i&3),r=Math.min(e+3&-4,n);if(n-r>3){for(let l=e;l<r;l++)this.drawPoint(t,l,s);const c=E*s+r>>>2,a=E*s+n>>>2,h=t*85;this.bytes.fill(h,c,a),e=n}for(let c=e;c<i;c++)this.drawPoint(t,c,s)}drawHLineUnclipped(t,e,s,i){s>=0&&s<x&&(e<0&&(e=0),i>E&&(i=E),e<i&&this.drawHLineFast(t,e,s,i))}drawHLine(t,e,s){const i=this.drawColors[0]&15;if(i==0)return;const n=i-1&3;this.drawHLineUnclipped(n,t,e,t+s)}drawVLine(t,e,s){if(e+s<=0||t<0||t>=E)return;const i=this.drawColors[0]&15;if(i==0)return;const n=Math.max(0,e),r=Math.min(x,e+s),c=i-1&3;for(let a=n;a<r;a++)this.drawPoint(c,t,a)}drawRect(t,e,s,i){const n=Math.max(0,t),r=Math.max(0,e),c=t+s,a=e+i,h=Math.max(0,Math.min(c,E)),l=Math.max(0,Math.min(a,x)),d=this.drawColors[0],u=d&15,w=d>>>4&15;if(u!==0){const b=u-1&3;for(let p=r;p<l;++p)this.drawHLineFast(b,n,p,h)}if(w!==0){const b=w-1&3;if(t>=0&&t<E)for(let p=r;p<l;++p)this.drawPoint(b,t,p);if(c>0&&c<=E)for(let p=r;p<l;++p)this.drawPoint(b,c-1,p);e>=0&&e<x&&this.drawHLineFast(b,n,e,h),a>0&&a<=x&&this.drawHLineFast(b,n,a-1,h)}}drawOval(t,e,s,i){const n=this.drawColors[0],r=n&15,c=n>>>4&15;if(c===15)return;const a=c-1&3,h=r-1&3;let l=s-1;const d=i-1;let u=d%2,w=e+Math.floor(i/2),b=t,p=t+s-1,f=w-u;const m=l*l,y=d*d;let g=4*(1-l)*y,_=4*(u+1)*m,v=g+_+u*m;l=8*m,u=8*y;do{this.drawPointUnclipped(a,p,w),this.drawPointUnclipped(a,b,w),this.drawPointUnclipped(a,b,f),this.drawPointUnclipped(a,p,f);const k=b+1,T=p-k;r!==0&&T>0&&(this.drawHLineUnclipped(h,k,w,p),this.drawHLineUnclipped(h,k,f,p));const P=2*v;P<=_&&(w+=1,f-=1,_+=l,v+=_),(P>=g||P>_)&&(b+=1,p-=1,g+=u,v+=g)}while(b<=p);for(;w-f<i;)this.drawPointUnclipped(a,b-1,w),this.drawPointUnclipped(a,p+1,w),w+=1,this.drawPointUnclipped(a,b-1,f),this.drawPointUnclipped(a,p+1,f),f-=1}drawLine(t,e,s,i){const r=this.drawColors[0]&15;if(r===0)return;const c=r-1&3;if(e>i){let w=t;t=s,s=w,w=e,e=i,i=w}const a=Math.abs(s-t),h=t<s?1:-1,l=i-e;let d=(a>l?a:-l)/2,u;for(;this.drawPointUnclipped(c,t,e),!(t===s&&e===i);)u=d,u>-a&&(d-=l,t+=h),u<l&&(d+=a,e++)}drawText(t,e,s){let i=e;for(let n=0,r=t.length;n<r;++n){const c=t[n];if(c===0)return;c===10?(s+=8,i=e):(c>=32&&c<=255&&this.blit(ts,i,s,8,8,0,c-32<<3,8),i+=8)}}blit(t,e,s,i,n,r,c,a,h=!1,l=!1,d=!1,u=!1){const w=this.drawColors[0];let b,p,f,m;u?(l=!l,b=Math.max(0,s)-s,p=Math.max(0,e)-e,f=Math.min(i,x-s),m=Math.min(n,E-e)):(b=Math.max(0,e)-e,p=Math.max(0,s)-s,f=Math.min(i,E-e),m=Math.min(n,x-s));for(let y=p;y<m;y++)for(let g=b;g<f;g++){const _=e+(u?y:g),v=s+(u?g:y),k=r+(l?i-g-1:g),T=c+(d?n-y-1:y);let P;const $=T*a+k;if(h){const Lt=t[$>>>2],Rt=6-(($&3)<<1);P=Lt>>>Rt&3}else{const Lt=t[$>>>3],Rt=7-($&7);P=Lt>>>Rt&1}const Ee=w>>>(P<<2)&15;Ee!==0&&this.drawPoint(Ee-1&3,_,v)}}}const ys=4,ws=35044,ue=34962,pe=5121,bs=5126,At=6409,gs=35632,As=35633,vs=35713,Es=35714,fe=9728,_s=10240,Ss=10241,xs=10242,ks=10243,z=3553,Cs=33984,me=33071,V=4;class Ts{constructor(t){this.gl=t,this.colorBuffer=new Uint32Array(E*x>>2),this.paletteBuffer=new Float32Array(3*V),this.lastPalette=Array(V),this.paletteLocation=null;const e=new Uint32Array(256);for(let i=0;i<256;++i){const n=i>>6&3,r=i>>4&3,c=i>>2&3,a=i&3;e[i]=n<<30|r<<22|c<<14|a<<6}this.table=e;const s=t.canvas;s.addEventListener("webglcontextlost",i=>{i.preventDefault()}),s.addEventListener("webglcontextrestored",()=>{this.initGL()}),this.initGL()}initGL(){const t=this.gl;this.lastPalette=Array(V);function e(d,u){const w=t.createShader(d);if(t.shaderSource(w,u),t.compileShader(w),!t.getShaderParameter(w,vs))throw new Error(t.getShaderInfoLog(w)+"");return w}function s(d){const u=t.createTexture();t.activeTexture(d),t.bindTexture(z,u),t.texParameteri(z,xs,me),t.texParameteri(z,ks,me),t.texParameteri(z,_s,fe),t.texParameteri(z,Ss,fe)}const i=e(As,`
            attribute vec2 pos;
            varying vec2 framebufferCoord;

            void main () {
                framebufferCoord = pos*vec2(0.5, -0.5) + 0.5;
                gl_Position = vec4(pos, 0, 1);
            }
        `),n=Array.from({length:V-1},(d,u)=>`p = mix(p, palette[${u+1}],  step(${((u+1)/V).toFixed(2)}, index));`).join(`
`),r=e(gs,`
            precision mediump float;
            uniform vec3 palette[${V}];
            uniform sampler2D framebuffer;
            varying vec2 framebufferCoord;

            vec3 lookup(float index) {
                vec3 p = palette[0];
                ${n}
                return p;
            }

            void main () {
                gl_FragColor = vec4(lookup(texture2D(framebuffer, framebufferCoord).r), 1.);
            }
        `),c=t.createProgram();if(t.attachShader(c,i),t.attachShader(c,r),t.linkProgram(c),!t.getProgramParameter(c,Es))throw new Error(t.getProgramInfoLog(c)+"");t.useProgram(c),this.paletteLocation=t.getUniformLocation(c,"palette"),t.uniform1i(t.getUniformLocation(c,"framebuffer"),0),t.detachShader(c,i),t.deleteShader(i),t.detachShader(c,r),t.deleteShader(r),s(Cs),t.texImage2D(z,0,At,E,x,0,At,pe,null);const a=t.getAttribLocation(c,"pos"),h=t.createBuffer(),l=new Float32Array([-1,-1,-1,1,1,1,1,1,1,-1,-1,-1]);t.bindBuffer(ue,h),t.bufferData(ue,l,ws),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,bs,!1,0,0)}composite(t,e){const s=this.gl,i=e.bytes,n=this.colorBuffer,r=this.table,c=this.lastPalette,a=this.paletteBuffer;let h=!1;for(let l=0,d=0;l<V;++l){const u=t[l];h=h||c[l]!==u,a[d++]=(u>>16&255)/255,a[d++]=(u>>8&255)/255,a[d++]=(u&255)/255,c[l]=u}h&&s.uniform3fv(this.paletteLocation,this.paletteBuffer);for(let l=0;l<E*x>>2;++l)n[l]=r[i[l]];s.texImage2D(z,0,At,E,x,0,At,pe,new Uint8Array(n.buffer)),s.drawArrays(ys,0,6)}}const Ps=6,ye=7,we=3;function $s(o){const t=new DataView(o.buffer),e=t.getUint32(0),s=t.getUint32(4,!0);if(e!==6386541||s!==1)throw new Error("Invalid WASM binary");let i=8;const n=[];let r=0,c=0,a;for(;i<o.byteLength;){const h=o[i],l=i;[a,i]=dt(o,i+1);const d=i+a;let u=i;if(i+=a,h===Ps)r+=dt(o,u)[0];else if(h===ye){n.push([0,c,l]),c=d;const w=new Set,b=[];let p,f,m;[p,u]=dt(o,u);for(let v=0;v<p;v++){const k=u;[f,u]=dt(o,u),u+=f;const T=o[u++];[m,u]=dt(o,u),T===we&&w.add(m),b.push([0,k,u])}for(let v=0;v<r;v++)if(!w.has(v)){const k=new TextEncoder().encode(`__global_${v}`),T=vt(k.length),P=vt(v),$=new Uint8Array(k.length+T.length+P.length+1);$.set(T),$.set(k,T.length),$[T.length+k.length]=we,$.set(P,T.length+k.length+1),b.push([1,$])}const y=vt(b.length),g=be(o,b),_=vt(y.length+g.length);n.push([1,new Uint8Array([ye])]),n.push([1,_]),n.push([1,y]),n.push([1,g])}}return n.push([0,c,i]),be(o,n)}function be(o,t){const e=t.reduce((n,r)=>n+(r[0]===0?r[2]-r[1]:r[1].length),0),s=new Uint8Array(e);let i=0;for(const n of t)n[0]===0?(s.set(o.slice(n[1],n[2]),i),i+=n[2]-n[1]):(s.set(n[1],i),i+=n[1].length);return s}function vt(o){const t=[];do{const e=o&127;o>>=7,t.push(o?e|128:e)}while(o);return new Uint8Array(t)}function dt(o,t=0){let e=0,s=0,i=0;do e=o[t++],s|=(e&127)<<i,i+=7;while(e&128);return[s,t]}class Is{constructor(t){this.wasmBuffer=null,this.wasm=null,this.warnedFileSize=!1;const e=document.createElement("canvas");e.width=E,e.height=x,this.canvas=e;const s=e.getContext("webgl",{alpha:!1,depth:!1,antialias:!1});if(!s)throw new Error("web-runtime: could not create wegl context");this.compositor=new Ts(s),this.apu=new fs,this.diskName=t,this.diskBuffer=new ArrayBuffer(X);let i;try{i=localStorage.getItem(t)}catch(n){console.error("Error reading disk",n)}this.diskSize=i!=null?ae(i,new Uint8Array(this.diskBuffer)):0,this.memory=new WebAssembly.Memory({initial:1,maximum:1}),this.data=new DataView(this.memory.buffer),this.framebuffer=new ms(this.memory.buffer),this.reset(),this.pauseState=0,this.wasmBufferByteLen=0}async init(){await this.apu.init()}setMouse(t,e,s){this.data.setInt16(te,t,!0),this.data.setInt16(ee,e,!0),this.data.setUint8(Ke,s)}setGamepad(t,e){this.data.setUint8(Ye+t,e)}setNetplay(t){this.data.setUint8(Xe,4|t&3)}getSystemFlag(t){return this.data.getUint8(qe)&t}unlockAudio(){this.apu.unlockAudio()}pauseAudio(){this.apu.pauseAudio()}reset(t){const e=new Uint32Array(this.memory.buffer);t&&e.fill(0),this.pauseState&=~se,e.set(je,$t>>2),this.data.setUint16(lt,4611,!0),this.data.setInt16(te,32767,!0),this.data.setInt16(ee,32767,!0)}async load(t,e=!0){if(this.wasmBuffer=t,this.wasmBufferByteLen=t.byteLength,this.wasm=null,t.byteLength>1048576&&e)throw new Error("Cart too big!");const i={memory:this.memory,rect:this.framebuffer.drawRect.bind(this.framebuffer),oval:this.framebuffer.drawOval.bind(this.framebuffer),line:this.framebuffer.drawLine.bind(this.framebuffer),hline:this.framebuffer.drawHLine.bind(this.framebuffer),vline:this.framebuffer.drawVLine.bind(this.framebuffer),text:this.text.bind(this),textUtf8:this.textUtf8.bind(this),textUtf16:this.textUtf16.bind(this),blit:this.blit.bind(this),blitSub:this.blitSub.bind(this),tone:this.apu.tone.bind(this.apu),diskr:this.diskr.bind(this),diskw:this.diskw.bind(this),trace:this.trace.bind(this),traceUtf8:this.traceUtf8.bind(this),traceUtf16:this.traceUtf16.bind(this),tracef:this.tracef.bind(this)};await this.bluescreenOnError(async()=>{const n=$s(t),r=await WebAssembly.instantiate(n,{env:i});this.wasm=r.instance,typeof this.wasm.exports._start=="function"&&this.wasm.exports._start(),typeof this.wasm.exports._initialize=="function"&&this.wasm.exports._initialize()})}async bluescreenOnError(t){try{await t()}catch(e){if(e instanceof Error){const s=Us(e);this.blueScreen(s),this.printToServer(e.stack??"")}throw e}}text(t,e,s){const i=new Uint8Array(this.memory.buffer,t);this.framebuffer.drawText(i,e,s)}textUtf8(t,e,s,i){const n=new Uint8Array(this.memory.buffer,t,e);this.framebuffer.drawText(n,s,i)}textUtf16(t,e,s,i){const n=new Uint16Array(this.memory.buffer,t,e>>1);this.framebuffer.drawText(n,s,i)}blit(t,e,s,i,n,r){this.blitSub(t,e,s,i,n,0,0,i,r)}blitSub(t,e,s,i,n,r,c,a,h){const l=new Uint8Array(this.memory.buffer,t),d=h&1,u=h&2,w=h&4,b=h&8;this.framebuffer.blit(l,e,s,i,n,r,c,a,d,u,w,b)}diskr(t,e){const s=Math.min(e,this.diskSize),i=new Uint8Array(this.diskBuffer,0,s);return new Uint8Array(this.memory.buffer,t).set(i),s}diskw(t,e){const s=Math.min(e,X),i=new Uint8Array(this.memory.buffer,t,s),n=new Uint8Array(this.diskBuffer),r=oe(i);try{localStorage.setItem(this.diskName,r)}catch(c){console.error("Error writing disk",c)}return n.set(i),this.diskSize=s,s}getCString(t){let e="";for(;;){const s=this.data.getUint8(t++);if(s==0)break;e+=String.fromCharCode(s)}return e}print(t){console.log(t),this.printToServer(t)}printToServer(t){}trace(t){this.print(this.getCString(t))}traceUtf8(t,e){const s=new Uint8Array(this.memory.buffer,t,e),i=new TextDecoder().decode(s);this.print(i)}traceUtf16(t,e){const s=new Uint8Array(this.memory.buffer,t,e),i=new TextDecoder("utf-16").decode(s);this.print(i)}tracef(t,e){let s="",i;for(;i=this.data.getUint8(t++);)if(i==37)switch(i=this.data.getUint8(t++)){case 37:s+="%";break;case 99:s+=String.fromCharCode(this.data.getInt32(e,!0)),e+=4;break;case 100:case 120:s+=this.data.getInt32(e,!0).toString(i==100?10:16),e+=4;break;case 115:s+=this.getCString(this.data.getUint32(e,!0)),e+=4;break;case 102:s+=this.data.getFloat64(e,!0),e+=8;break;default:s+="%"+String.fromCharCode(i);break}else s+=String.fromCharCode(i);this.print(s)}start(){let t=this.wasm.exports.start;typeof t=="function"&&this.bluescreenOnError(t)}update(){if(this.pauseState!=0)return;this.getSystemFlag(Ze)||this.framebuffer.clear();let t=this.wasm.exports.update;typeof t=="function"&&this.bluescreenOnError(t),this.apu.tick()}blueScreen(t){this.pauseState|=se;const e=[1118702,8831084,11184810,16777215],s=u=>[...u].map(w=>w.charCodeAt(0)),i=` ${Ve} `,n=i,r=8*i.length,c=(160-8*i.length)/2,a=20,h=9,l=60;new Uint32Array(this.memory.buffer).set(e,$t>>2),this.data.setUint16(lt,4611,!0),this.framebuffer.clear(),this.framebuffer.drawHLine(c,a-1,r),this.data.setUint16(lt,4401,!0),this.framebuffer.drawText(s(n),c,a),this.data.setUint16(lt,4611,!0),this.framebuffer.drawText(s(t),h,l),this.composite()}composite(){const t=new Uint32Array(this.memory.buffer,$t,4);this.compositor.composite(t,this.framebuffer)}}function Us(o){if(o instanceof WebAssembly.RuntimeError){let t;return o.message.match(/unreachable/)?t=`The cartridge has
reached a code 
segment marked as
unreachable.`:o.message.match(/out of bounds/)&&(t=`The cartridge has
attempted a memory
access that is
out of bounds.`),t+`




Hit R to reboot.`}else{if(o instanceof WebAssembly.LinkError)return`The cartridge has
tried to import
a missing function.



See console for
more details.`;if(o instanceof WebAssembly.CompileError)return`The cartridge is
corrupted.



See console for
more details.`;if(o instanceof Os)return o.wasm4Message}return`Unknown error.



See console for
more details.`}class Os extends Error{constructor(t){super(t.replace(`
`," ")),this.name="Wasm4Error",this.wasm4Message=t}}var Ms=Object.defineProperty,Ls=Object.getOwnPropertyDescriptor,ut=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ls(t,e):t,n=o.length-1,r;n>=0;n--)(r=o[n])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Ms(t,e,i),i};class ge{constructor(){this.gamepad=[0,0,0,0],this.mouseX=0,this.mouseY=0,this.mouseButtons=0}}A.App=class extends M{constructor(){var t;super(),this.hideGamepadOverlay=!1,this.showMenu=!1,this.inputState=new ge,this.gamepadUnavailableWarned=new Set,this.onPointerUp=e=>{e.pointerType=="touch"&&ne(),this.runtime.unlockAudio()},this.diskPrefix=((t=document.getElementById("wasm4-disk-prefix"))==null?void 0:t.textContent)??It("disk-prefix"),this.runtime=new Is(`${this.diskPrefix}-disk`),this.init()}async init(){async function t(){const p=document.getElementById("wasm4-cart-json");if(p){const{WASM4_CART:f,WASM4_CART_SIZE:m}=JSON.parse(p.textContent??""),y=new Uint8Array(m);return ae(f,y),y}else{const f=It("url")??"cart.wasm",m=await fetch(f);if(m.ok)return new Uint8Array(await m.arrayBuffer());throw new Error(`Could not load cart at url: ${f}`)}}const e=this.runtime;await e.init();const s=e.canvas,i=It("netplay");i?(this.netplay=this.createNetplay(),this.netplay.join(i)):await e.load(await t());let n={toggleDevtools(){},updateCompleted(...p){}};this.netplay||e.start();function r(){e.composite(),s.toBlob(p=>{const f=URL.createObjectURL(p),m=document.createElement("a");m.href=f,m.download="wasm4-screenshot.png",m.click(),URL.revokeObjectURL(f)})}let c=null;function a(){if(c!=null)return;const p="video/webm",f=s.captureStream();c=new MediaRecorder(f,{mimeType:p,videoBitsPerSecond:25e6});const m=[];c.ondataavailable=y=>{m.push(y.data)},c.onstop=()=>{const y=new Blob(m,{type:p}),g=URL.createObjectURL(y),_=document.createElement("a");_.href=g,_.download="wasm4-animation.webm",_.click(),URL.revokeObjectURL(g)},c.start(),setTimeout(()=>{c&&(c.requestData(),c.stop(),c=null)},4e3)}const h=p=>{if(document.body.style.cursor="",p.isPrimary){const f=s.getBoundingClientRect(),m=this.inputState;m.mouseX=Math.fround(E*(p.clientX-f.left)/f.width),m.mouseY=Math.fround(x*(p.clientY-f.top)/f.height),m.mouseButtons=p.buttons&7}};window.addEventListener("pointerdown",h),window.addEventListener("pointerup",h),window.addEventListener("pointermove",h),s.addEventListener("contextmenu",p=>{p.preventDefault()});const l={2:this.saveGameState.bind(this),4:this.loadGameState.bind(this),r:this.resetCart.bind(this),R:this.resetCart.bind(this),F8:n.toggleDevtools,F9:r,F10:a,F11:ne,Enter:this.onMenuButtonPressed.bind(this)},d=p=>{if(p.ctrlKey||p.altKey||p.srcElement instanceof HTMLElement&&p.srcElement.tagName=="INPUT")return;const f=p.type=="keydown";if(e.unlockAudio(),document.body.style.cursor="none",f){const g=l[p.key];if(g){g(),p.preventDefault();return}}let m=0,y=0;switch(p.code){case"KeyX":case"KeyV":case"Space":case"Period":y=L;break;case"KeyZ":case"KeyC":case"Comma":y=F;break;case"ArrowUp":y=H;break;case"ArrowDown":y=G;break;case"ArrowLeft":y=J;break;case"ArrowRight":y=Z;break;case"KeyA":case"KeyQ":m=1,y=L;break;case"ShiftLeft":case"Tab":m=1,y=F;break;case"KeyE":m=1,y=H;break;case"KeyD":m=1,y=G;break;case"KeyS":m=1,y=J;break;case"KeyF":m=1,y=Z;break;case"NumpadMultiply":case"NumpadDecimal":m=2,y=L;break;case"NumpadSubtract":case"NumpadEnter":m=2,y=F;break;case"Numpad8":m=2,y=H;break;case"Numpad5":m=2,y=G;break;case"Numpad4":m=2,y=J;break;case"Numpad6":m=2,y=Z;break}if(y!=0){p.preventDefault();const g=this.inputState.gamepad;f?g[m]|=y:g[m]&=~y}};if(window.addEventListener("keydown",d),window.addEventListener("keyup",d),top&&top!=window)try{top.addEventListener("keydown",d),top.addEventListener("keyup",d)}catch{}const u=()=>{if(navigator.getGamepads)for(const p of navigator.getGamepads()){if(p==null)continue;if(p.mapping!="standard"){this.gamepadUnavailableWarned.has(p.id)||(this.gamepadUnavailableWarned.add(p.id),this.notifications.show("Unsupported gamepad: "+p.id));continue}const f=p.buttons,m=p.axes;let y=0;(f[12].pressed||m[1]<-.5)&&(y|=H),(f[13].pressed||m[1]>.5)&&(y|=G),(f[14].pressed||m[0]<-.5)&&(y|=J),(f[15].pressed||m[0]>.5)&&(y|=Z),(f[0].pressed||f[3].pressed||f[5].pressed||f[7].pressed)&&(y|=L),(f[1].pressed||f[2].pressed||f[4].pressed||f[6].pressed)&&(y|=F),f[9].pressed&&(this.showMenu=!0),this.inputState.gamepad[p.index%4]=y}};let w=performance.now();const b=p=>{requestAnimationFrame(b),u();let f=this.inputState;if(this.menuOverlay!=null)if(this.menuOverlay.applyInput(),this.netplay)f=new ge;else return;let m=!1;for(p-w>=200&&(w=p);p>=w;)if(w+=1e3/60,this.netplay)this.netplay.update(f.gamepad[0])&&(m=!0);else{for(let y=0;y<4;++y)e.setGamepad(y,f.gamepad[y]);e.setMouse(f.mouseX,f.mouseY,f.mouseButtons),e.update(),m=!0}m&&(this.hideGamepadOverlay=!!e.getSystemFlag(Qe),e.composite())};requestAnimationFrame(b)}onMenuButtonPressed(){this.showMenu?this.inputState.gamepad[0]|=L:this.showMenu=!0}closeMenu(){if(this.showMenu){this.showMenu=!1;for(let t=0;t<4;++t)this.inputState.gamepad[t]=0}}saveGameState(){let t=this.savedGameState;t==null&&(t=this.savedGameState=new ht),t.read(this.runtime),this.notifications.show("State saved")}loadGameState(){if(this.netplay){this.notifications.show("State loading disabled during netplay");return}const t=this.savedGameState;t!=null?(t.write(this.runtime),this.notifications.show("State loaded")):this.notifications.show("Need to save a state first")}exportGameDisk(){if(this.runtime.diskSize<=0){this.notifications.show("Disk is empty");return}const t=new Uint8Array(this.runtime.diskBuffer).slice(0,this.runtime.diskSize),e=new Blob([t],{type:"application/octet-stream"}),s=document.createElement("a");s.style.display="none",s.href=URL.createObjectURL(e),s.download=`${this.diskPrefix}.disk`,document.body.appendChild(s),s.click(),document.body.removeChild(s)}importGameDisk(){if(this.netplay){this.notifications.show("Disk importing disabled during netplay");return}const t=this,e=document.createElement("input");e.style.display="none",e.type="file",e.accept=".disk",e.multiple=!1,e.addEventListener("change",()=>{const s=e.files;let i=new FileReader;i.addEventListener("load",()=>{let n=new Uint8Array(i.result).slice(0,X),r=new Uint8Array(X);r.set(n),t.runtime.diskBuffer=r.buffer,this.runtime.diskSize=n.length;const c=oe(n);try{localStorage.setItem(this.runtime.diskName,c),t.notifications.show("Disk imported")}catch(a){t.notifications.show("Error importing disk"),console.error("Error importing disk",a)}t.closeMenu()}),i.readAsArrayBuffer(s[0])}),document.body.appendChild(e),e.click(),document.body.removeChild(e)}clearGameDisk(){if(this.netplay){this.notifications.show("Disk clearing disabled during netplay");return}this.runtime.diskBuffer=new ArrayBuffer(X),this.runtime.diskSize=0;try{localStorage.removeItem(this.runtime.diskName)}catch(t){this.notifications.show("Error clearing disk"),console.error("Error clearing disk",t)}this.notifications.show("Disk cleared")}async copyNetplayLink(){this.netplay||(this.netplay=this.createNetplay(),this.netplay.host()),es(await this.netplay.getInviteLink()),this.notifications.show("Netplay link copied to clipboard")}async resetCart(t,e=!1){if(this.netplay){this.notifications.show("Reset disabled during netplay");return}t||(t=this.runtime.wasmBuffer);let s;e&&(s=new ht,s.read(this.runtime)),this.runtime.reset(!0),this.runtime.pauseState|=ie,await this.runtime.load(t),this.runtime.pauseState&=~ie,s?s.write(this.runtime):this.runtime.start()}createNetplay(){const t=new ps(this.runtime);return t.onstart=e=>this.notifications.show(`Joined as player ${e+1}`),t.onjoin=e=>this.notifications.show(`Player ${e+1} joined`),t.onleave=e=>this.notifications.show(`Player ${e+1} left`),t}getNetplaySummary(){return this.netplay?this.netplay.getSummary():[]}connectedCallback(){super.connectedCallback(),window.addEventListener("pointerup",this.onPointerUp)}disconnectedCallback(){window.removeEventListener("pointerup",this.onPointerUp),super.disconnectedCallback()}render(){return C`
            <div class="content">
                ${this.showMenu?C`<wasm4-menu-overlay .app=${this} />`:""}
                <wasm4-notifications></wasm4-notifications>
                ${this.runtime.canvas}
            </div>
            ${this.hideGamepadOverlay?"":C`<wasm4-virtual-gamepad .app=${this} />`}
        `}},A.App.styles=ft`
        :host {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;

            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;

            background: #202020;
        }

        .content {
            width: 100vmin;
            height: 100vmin;
            overflow: hidden;
        }

        /** Nudge the game upwards a bit in portrait to make space for the virtual gamepad. */
        @media (pointer: coarse) and (max-aspect-ratio: 2/3) {
            .content {
                position: absolute;
                top: calc((100% - 220px - 100vmin)/2)
            }
        }

        .content canvas {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
    `,ut([at()],A.App.prototype,"hideGamepadOverlay",2),ut([at()],A.App.prototype,"showMenu",2),ut([ct("wasm4-menu-overlay")],A.App.prototype,"menuOverlay",2),ut([ct("wasm4-notifications")],A.App.prototype,"notifications",2),A.App=ut([bt("wasm4-app")],A.App);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*Ut(o,t){if(o!==void 0){let e=0;for(const s of o)yield t(s,e++)}}var Rs=Object.defineProperty,Ds=Object.getOwnPropertyDescriptor,Ot=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ds(t,e):t,n=o.length-1,r;n>=0;n--)(r=o[n])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Rs(t,e,i),i};const j={DEFAULT:0,DISK:1},Ns=[{CONTINUE:0,SAVE_STATE:1,LOAD_STATE:2,DISK_OPTIONS:3,COPY_NETPLAY_LINK:4,RESET_CART:5},{BACK:0,EXPORT_DISK:1,IMPORT_DISK:2,CLEAR_DISK:3}],Mt=[["CONTINUE","SAVE STATE","LOAD STATE","DISK OPTIONS","COPY NETPLAY URL","RESET CART"],["BACK","EXPORT DISK","IMPORT DISK","CLEAR DISK"]];A.MenuOverlay=class extends M{constructor(){super(),this.lastGamepad=0,this.selectedIdx=0,this.netplaySummary=[],this.optionContext=0,this.optionContextHistory=[]}get optionIndex(){return Ns[this.optionContext]}get options(){return Mt[this.optionContext]}previousContext(){if(this.optionContextHistory.length>0){const t=this.optionContextHistory.pop();this.resetInput(),this.optionContext=t.context,this.selectedIdx=t.index}}switchContext(t,e=0){this.optionContextHistory.push({context:this.optionContext,index:this.selectedIdx}),this.resetInput(),this.optionContext=t,this.selectedIdx=e}resetInput(){this.app.inputState.gamepad[0]=0}applyInput(){let t=0;for(const s of this.app.inputState.gamepad)t|=s;const e=t&(t^this.lastGamepad);if(this.lastGamepad=t,e&(L|F)){if(this.optionContext===j.DEFAULT)switch(this.selectedIdx){case this.optionIndex.CONTINUE:this.app.closeMenu();break;case this.optionIndex.SAVE_STATE:this.app.saveGameState(),this.app.closeMenu();break;case this.optionIndex.LOAD_STATE:this.app.loadGameState(),this.app.closeMenu();break;case this.optionIndex.DISK_OPTIONS:this.switchContext(j.DISK);break;case this.optionIndex.COPY_NETPLAY_LINK:this.app.copyNetplayLink(),this.app.closeMenu();break;case this.optionIndex.RESET_CART:this.app.resetCart(),this.app.closeMenu();break}else if(this.optionContext===j.DISK)switch(this.selectedIdx){case this.optionIndex.BACK:this.previousContext();break;case this.optionIndex.EXPORT_DISK:this.app.exportGameDisk(),this.app.closeMenu();break;case this.optionIndex.IMPORT_DISK:this.resetInput(),this.app.importGameDisk();break;case this.optionIndex.CLEAR_DISK:this.app.clearGameDisk(),this.app.closeMenu();break}}e&G&&this.selectedIdx++,e&H&&this.selectedIdx--,this.selectedIdx=(this.selectedIdx+this.options.length)%this.options.length}connectedCallback(){super.connectedCallback();const t=()=>{this.netplaySummary=this.app.getNetplaySummary()};t(),this.netplayPollInterval=window.setInterval(t,1e3)}disconnectedCallback(){window.clearInterval(this.netplayPollInterval),super.disconnectedCallback()}render(){return C`
            <div class="version">
                WASM-4 v${"2.7.0"}
            </div>
            <div class="menu">
                <ul style="display:${this.optionContext===j.DEFAULT?"inherit":"none"}">
                    ${Ut(Mt[j.DEFAULT],(t,e)=>C`<li class="${this.selectedIdx==e?"selected":""}"}>${t}</li>`)}
                </ul>
                <ul style="display:${this.optionContext===j.DISK?"inherit":"none"}">
                    ${Ut(Mt[j.DISK],(t,e)=>C`<li class="${this.selectedIdx==e?"selected":""}"}>${t}</li>`)}
                </ul>
            </div>
            <div class="netplay-summary">
                ${Ut(this.netplaySummary,t=>{const e=t.ping<100?"good":t.ping<200?"ok":"bad",s=t.ping<0?C`<span class="ping-you">YOU</span>`:C`<span class="ping-${e}">${Math.ceil(t.ping)}ms</span>`;return C`<div>PLAYER ${t.playerIdx>=0?t.playerIdx+1:"?"} ${s}</div>`})}
            </div>
        `}},A.MenuOverlay.styles=ft`
        :host {
            width: 100vmin;
            height: 100vmin;
            position: absolute;

            color: #a0a0a0;
            font: 16px wasm4-font;

            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;

            background: rgba(0, 0, 0, 0.85);
        }

        .version {
            color: #fff;
            padding-bottom: 1em;
        }

        .menu {
            border: 2px solid #f0f0f0;
            padding: 0 1em 0 1em;
            line-height: 2em;
        }

        .netplay-summary {
            margin-top: 2em;
            line-height: 1.5em;
        }

        .ping-you {
            color: #f0f0f0;
        }

        .ping-good {
            color: green;
        }

        .ping-ok {
            color: yellow;
        }

        .ping-bad {
            color: red;
        }

        ul {
            list-style: none;
            padding-left: 0;
            padding-right: 1em;
        }

        li::before {
            content: "\\00a0\\00a0";
        }
        li.selected::before {
            content: "> ";
        }
        li.selected {
            color: #fff;
        }
    `,Ot([at()],A.MenuOverlay.prototype,"selectedIdx",2),Ot([at()],A.MenuOverlay.prototype,"netplaySummary",2),A.MenuOverlay=Ot([bt("wasm4-menu-overlay")],A.MenuOverlay);var Bs=Object.defineProperty,Fs=Object.getOwnPropertyDescriptor,Et=(o,t,e,s)=>{for(var i=s>1?void 0:s?Fs(t,e):t,n=o.length-1,r;n>=0;n--)(r=o[n])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Bs(t,e,i),i};function Q(o,t,e){o&&(e?o.classList.add(t):o.classList.remove(t))}A.VirtualGamepad=class extends M{constructor(){super(...arguments),this.touchEvents=new Map,this.onPointerEvent=t=>{if(t.pointerType!="touch")return;switch(t.preventDefault(),t.type){case"pointerdown":case"pointermove":this.touchEvents.set(t.pointerId,t);break;default:this.touchEvents.delete(t.pointerId);break}let e=0;if(this.touchEvents.size){const c=this.dpad.getBoundingClientRect(),a=c.x+c.width/2,h=c.y+c.height/2,l=this.action1.getBoundingClientRect(),d=l.x+l.width/2,u=l.y+l.height/2,w=this.action2.getBoundingClientRect(),b=w.x+w.width/2,p=w.y+w.height/2;let f,m,y,g,_;for(const v of this.touchEvents.values())f=v.clientX-a,m=v.clientY-h,y=Math.sqrt(f*f+m*m),y<100&&y>10&&(g=f/y,_=m/y,-g>.6?e|=J:g>.6&&(e|=Z),-_>.6?e|=H:_>.6&&(e|=G)),f=v.clientX-d,m=v.clientY-u,f*f+m*m<2500&&(e|=L),f=v.clientX-b,m=v.clientY-p,f*f+m*m<2500&&(e|=F)}Q(this.action1,"pressed",e&L),Q(this.action2,"pressed",e&F),Q(this.dpad,"pressed-left",e&J),Q(this.dpad,"pressed-right",e&Z),Q(this.dpad,"pressed-up",e&H),Q(this.dpad,"pressed-down",e&G),this.app.inputState.gamepad[0]=e}}connectedCallback(){super.connectedCallback(),window.addEventListener("pointercancel",this.onPointerEvent),window.addEventListener("pointerdown",this.onPointerEvent),window.addEventListener("pointermove",this.onPointerEvent),window.addEventListener("pointerup",this.onPointerEvent)}disconnectedCallback(){window.removeEventListener("pointercancel",this.onPointerEvent),window.removeEventListener("pointerdown",this.onPointerEvent),window.removeEventListener("pointermove",this.onPointerEvent),window.removeEventListener("pointerup",this.onPointerEvent),super.disconnectedCallback()}onMenuButtonPressed(t){this.app.onMenuButtonPressed(),t.stopImmediatePropagation()}render(){return C`
            <div class="menu" @pointerdown="${this.onMenuButtonPressed}"></div>
            <div class="dpad"></div>
            <div class="action1">X</div>
            <div class="action2">Z</div>
        `}},A.VirtualGamepad.styles=ft`
        :host {
            display: none;
        }
        @media (hover: none) or (pointer: coarse) {
            :host {
                display: inherit;
            }
        }

        .dpad {
            pointer-events: none;
            position: absolute;
            width: 39px;
            height: 120px;
            left: 69px;
            bottom: 30px;
            background: #444;
            border-radius: 9px;
        }
        .dpad:before {
            position: absolute;
            width: 120px;
            height: 39px;
            top: 39px;
            left: -39px;
            background: #444;
            border-radius: 9px;
            content: "";
        }
        .dpad:after {
            position: absolute;
            height: 39px;
            width: 39px;
            top: 39px;
            border-radius: 100%;
            background: #333;
            content: "";
        }
        .dpad.pressed-left:before {
            border-left: 4px solid #A93671;
            width: 116px;
        }
        .dpad.pressed-right:before {
            border-right: 4px solid #A93671;
            width: 116px;
        }
        .dpad.pressed-up {
            border-top: 4px solid #A93671;
        }
        .dpad.pressed-down {
            border-bottom: 4px solid #A93671;
            height: 116px;
        }

        .action1 {
            right: 80px;
            bottom: 30px;
        }
        .action2 {
            right: 30px;
            bottom: 90px;
        }
        .action1, .action2 {
            pointer-events: none;
            position: absolute;
            width: 60px;
            height: 60px;
            border: 4px solid #A93671;
            border-radius: 50px;

            /** TODO(2022-03-14): Button text should be centered but is off slightly. */
            color: #A93671;
            font: 24px wasm4-font;
            text-align: center;
            line-height: 60px;
        }
        .action1.pressed, .action2.pressed {
            background: #A93671;
        }

        .menu {
            position: absolute;
            background: #444;
            width: 60px;
            height: 20px;
            bottom: 200px;
            right: 35px;
            border-radius: 10px;
        }
    `,Et([ct(".dpad")],A.VirtualGamepad.prototype,"dpad",2),Et([ct(".action1")],A.VirtualGamepad.prototype,"action1",2),Et([ct(".action2")],A.VirtualGamepad.prototype,"action2",2),A.VirtualGamepad=Et([bt("wasm4-virtual-gamepad")],A.VirtualGamepad);var Hs=Object.defineProperty,Gs=Object.getOwnPropertyDescriptor,Ae=(o,t,e,s)=>{for(var i=s>1?void 0:s?Gs(t,e):t,n=o.length-1,r;n>=0;n--)(r=o[n])&&(i=(s?r(t,e,i):r(i))||i);return s&&i&&Hs(t,e,i),i};return A.Notifications=class extends M{constructor(){super(...arguments),this.notifications=[]}show(t){this.notifications=this.notifications.concat([t]),setTimeout(()=>{this.notifications=this.notifications.slice(1)},5e3)}render(){return this.notifications.map(t=>C`<div class="notification">${t}</div>`)}},A.Notifications.styles=ft`
        :host {
            width: 100vmin;
            height: 100vmin;
            position: absolute;
            pointer-events: none;

            color: #fff;
            font: 24px wasm4-font;

            display: flex;
            flex-direction: column;
        }

        .notification {
            background: rgba(0, 0, 0, 0.85);
            padding: 0.5em;
            /* animation: appear 0.5s ease-out, disappear 0.5s 4.5s ease-in; */
            /* animation-fill-mode: forwards; */
            animation: appear 0.5s ease-out;
        }

        @keyframes appear {
            from {
                padding-left: 2em;
                opacity: 0;
            }
            to {
                opacity: 1;
                padding-left: 0.5em;
            }
        }

        /*@keyframes disappear {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }*/
    `,Ae([at()],A.Notifications.prototype,"notifications",2),A.Notifications=Ae([bt("wasm4-notifications")],A.Notifications),Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),A}({});
